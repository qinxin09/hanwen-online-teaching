<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.bilibili.dao.diy.MyMapper">
    <resultMap id="videoGroupInfo" type="com.example.bilibili.pojo.diy.VideoGroupInfo">
        <id property="id" column="id"></id>
        <result property="title" column="title" ></result>
        <result property="authorId" column="author_id" ></result>
        <result property="brief" column="brief" ></result>
        <result property="pName" column="p_name" ></result>
        <result property="coverUrl" column="cover_url" ></result>
        <result property="createTime" column="create_time" ></result>
        <result property="catagory" jdbcType="LONGVARCHAR" column="catagory" ></result>
        <result property="istoll" column="istoll" ></result>
        <result property="price" column="price" ></result>
        <result property="videos" jdbcType="LONGVARCHAR" column="videos" ></result>
        <result property="name" column="name" ></result>
        <result property="playCount" column="play_count" ></result>
        <result property="commentCount" column="comment_count" ></result>
        <result property="attachementNames" column="attachement_names" ></result>

    </resultMap>

    <select id="selectVideoGroupInfo_CollectionByUserId" parameterType="java.lang.Long" resultMap="videoGroupInfo">
        select videogroup.*,user.name
            as name from videogroup,mycollect,user
        where videogroup.id=mycollect.group_id and mycollect.user_id=#{userId,jdbcType=BIGINT} and mycollect.user_id=user.id
    </select>
    <select id="selectVideoGroupInfo_LikedByUserId" parameterType="java.lang.Long" resultMap="videoGroupInfo">
        select videogroup.*,user.name
            as name from videogroup,mylike,user
        where mylike.user_id=#{authorId,jdbcType=BIGINT} and videogroup.id=mylike.group_id and mylike.user_id=user.id
    </select>
    <select id="selectVideoGroupInfo_WaitByUserId" parameterType="java.lang.Long" resultMap="videoGroupInfo">
        select videogroup.*,user.name
            as name from videogroup,user
        where videogroup.author_id=#{authorId,jdbcType=BIGINT} and videogroup.author_id=user.id and videogroup.state='0'
--           and videogroup.id=mylike.group_id  and mylike.user_id=user.id 等待把表给分离完毕 再加上条件
    </select>

    <select id="selectVideoGroupInfoByUserId" parameterType="java.lang.Long" resultMap="videoGroupInfo">
        select videogroup.*,user.name
            as name from videogroup,user
        where  videogroup.author_id=#{authorId,jdbcType=BIGINT} and user.id = #{authorId,jdbcType=BIGINT}
    </select>
<!--    按播放量排序-->
    <select id="selectVideoGroupInfo" resultMap="videoGroupInfo">
        select videogroup.*,user.name
            as name from videogroup,user
        where  videogroup.author_id=user.id
        ORDER BY videogroup.play_count DESC
    </select>

    <select id="selectVideoGroupInfoByHot" parameterType="java.lang.Integer" resultMap="videoGroupInfo">
        select videogroup.*,user.name
            as name from videogroup,user
        where  videogroup.author_id=user.id
        ORDER BY videogroup.play_count DESC
         LIMIT ${limitNum}
    </select>

    <select id="selectVideoGroupInfoPassed" resultMap="videoGroupInfo">
        select videogroup.*,user.name
            as name from videogroup,user
        where  videogroup.author_id=user.id AND videogroup.state=1
        ORDER BY videogroup.create_time DESC
    </select>
<!--    评论-->
    <resultMap id="myCommentMapper" type="com.example.bilibili.pojo.diy.MyComment">
        <result property="content" column="content"></result>
        <result property="createTime" column="create_time"></result>
        <result property="userId" column="user_id"></result>
        <result property="name" column="name"></result>
    </resultMap>
    <select id="getCommentsByGroupId" resultType="com.example.bilibili.pojo.diy.MyComment" resultMap="myCommentMapper">
        select comment.content,comment.create_time,comment.user_id,user.name from comment,user where comment.group_id=#{groupId} and comment.user_id=user.id
    </select>

<!--    个人中心-->
    <select id="countLikeById" parameterType="java.lang.Long" resultType="java.lang.Long">
        SELECT COUNT(*) FROM `user`,`videogroup`,`mylike` WHERE user.id = videogroup.author_id AND videogroup.id=mylike.`group_id` AND user.id=#{authorId}
    </select>
    <select id="getFens" parameterType="java.lang.Long" resultType="java.lang.Long">
        SELECT COUNT(*) from concern where concern.authorid = #{authorId} and concern.userid!=concern.authorid
    </select>
    <select id="getConcernNumById" parameterType="java.lang.Long" resultType="java.lang.Long">
        SELECT COUNT(*) from concern where concern.userid = #{userId} and concern.userid!=concern.authorid
    </select>

    <select id="getMenuTree" resultType="com.example.bilibili.pojo.diy.MyAdminTree" >
        SELECT * FROM admintree WHERE ftreeID = #{ftreeID} AND FIND_IN_SET(#{lv},lv) ORDER BY admintree.streeID;
    </select>
    <select id="getMenuTreeByLv" resultType="com.example.bilibili.pojo.AdminTree" >
        SELECT * FROM admintree WHERE FIND_IN_SET(#{lv},lv) ORDER BY admintree.streeID;
    </select>
</mapper>